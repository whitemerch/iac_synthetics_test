terraform {
  required_version = ">= 1.5.0"
  required_providers {
    aws    = { source = "hashicorp/aws", version = "~> 5.0" }
    random = { source = "hashicorp/random", version = "~> 3.0" }
  }
}

provider "aws" {
  region = "eu-west-3" # Paris – change if needed
}

resource "random_pet" "suffix" {
  length = 2
}

# ❌ Intentionally misconfigured: no SSE
resource "aws_sqs_queue" "unencrypted_test" {
  name = "iac-misconfig-queue-${random_pet.suffix.id}"

  # No kms_master_key_id
  # No sqs_managed_sse_enabled
  # => Triggers “SQS queue should have server-side encryption” in scanners

  delay_seconds             = 0
  max_message_size          = 262144
  message_retention_seconds = 345600
  receive_wait_time_seconds = 0

  tags = {
    purpose             = "iac-misconfig-test"
    "terraform.managed" = "true"
  }
}

output "queue_name" { value = aws_sqs_queue.unencrypted_test.name }
output "queue_url"  { value = aws_sqs_queue.unencrypted_test.url }
output "queue_arn"  { value = aws_sqs_queue.unencrypted_test.arn }
